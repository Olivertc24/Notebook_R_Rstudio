---
title: "Módulo 6: Visualización Avanzada"
subtitle: "La Gramática de Gráficos con ggplot2"
author: "Prof. Oliver Triveño"
format: 
  revealjs:
    theme: simple
    transition: slide
    slide-number: true
    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/R_logo.svg/724px-R_logo.svg.png"
    footer: "Visualización con ggplot2"
    echo: true
    fig-width: 6
    fig-height: 4
editor: visual
lang: es
---

## La Filosofía `ggplot2`

A diferencia de Excel, aquí no elegimos un "gráfico de la galería". Construimos el gráfico por **capas**, como si estuviéramos pintando un cuadro.

La estructura básica es: $$Gráfico = Datos + Estética (aes) + Geometría (geom)$$

------------------------------------------------------------------------

## Preparando los Datos

Vamos a simular una cartera de seguros de Automóvil para los ejemplos.

```{r}
#| message: false
library(tidyverse)

# Semilla para reproducibilidad
set.seed(123)

cartera <- tibble(
  edad = sample(18:70, 100, replace = TRUE),
  tipo_auto = sample(c("Sedan", "SUV", "Deportivo"), 100, replace = T),
  prima = jitter(edad * 10 + sample(200:500, 100)),
  siniestro = sample(c(0, 1), 100, replace = TRUE, prob = c(0.8, 0.2))
) %>% 
  mutate(siniestro = as.factor(siniestro))
```

## 1. Dispersión (Scatter Plot)

Relación entre dos variables numéricas.

**OJO**: Usamos + para agregar capas, no %\>%.

::::: columns
::: {.column width="50%"}
```{r}
#| label: scatter
#| eval: false
ggplot(data = cartera, 
       aes(x = edad, 
           y = prima)) +
  geom_point(color = "blue", 
             size = 3)
```

-   Data: cartera
-   Aes: x=edad, y=prima
-   Geom: Puntos
:::

::: {.column width="50%"}
```{r}
#| label: scatter-out
#| echo: false
ggplot(data = cartera, aes(x = edad, y = prima)) +
  geom_point(color = "blue", size = 3) + theme_minimal()
```
:::
:::::

------------------------------------------------------------------------

## 2. Mapeo de Colores (Aesthetics)

¿Y si queremos que el color dependa de una variable (ej. Tipo de Auto)? Movemos color DENTRO de aes().

::::: columns
::: {.column width="45%"}
```{r}
#| label: aes-color
#| eval: false
ggplot(cartera, 
       aes(x = edad, 
           y = prima,
           color = tipo_auto)) +
  geom_point(size = 3)
```
:::

::: {.column width="55%"}
```{r}
#| label: aes-color-out
#| echo: false
ggplot(cartera, aes(x = edad, y = prima, color = tipo_auto)) +
  geom_point(size = 3) + theme_minimal(base_size = 14) + theme(legend.position="top")
```
:::
:::::

------------------------------------------------------------------------

## 3. Gráficos de Distribución

Vitales para actuarios: Histogramas y Boxplots.

Histograma (Variable Numérica)

::::: columns
::: {.column width="40%"}
```{r}
#| label: hist
#| eval: false
ggplot(cartera, 
       aes(x = prima)) +
  geom_histogram(
    bins = 15,
    fill = "skyblue",
    color = "black"
  )
```
:::

::: {.column width="60%"}
```{r}
#| label: hist-out
#| echo: false
ggplot(cartera, aes(x = prima)) +
  geom_histogram(bins = 15, fill = "skyblue", color = "black") + theme_minimal()
```
:::
:::::

------------------------------------------------------------------------

## Boxplot (Numérica vs Categórica)

Para ver dispersión y outliers por grupo.

:::: columns
::: {.column width="40%"}
```{r}
#| label: box
#| eval: false
ggplot(cartera, 
       aes(x = tipo_auto, 
           y = prima,
           fill = tipo_auto)) +
  geom_boxplot()
```
:::
:::: {.column width="60%"}
```{r}
#| label: box-out
#| echo: false
ggplot(cartera, 
       aes(x = tipo_auto, 
           y = prima,
           fill = tipo_auto)) +
  geom_boxplot()
```
:::
:::::
