---
title: "M贸dulo 7: Programaci贸n Funcional"
subtitle: "Control de Flujo y Automatizaci贸n"
author: "Prof. Oliver Trive帽o"
format: 
  revealjs:
    theme: simple
    transition: slide
    slide-number: true
    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/R_logo.svg/724px-R_logo.svg.png"
    footer: "Funciones y Loops en R"
    echo: true
    highlight-style: github
editor: visual
lang: es
---

## Objetivo

Automatizar tareas repetitivas y tomar decisiones l贸gicas.

> "Si te encuentras copiando y pegando el mismo c贸digo m谩s de dos veces, es hora de escribir una funci贸n."

------------------------------------------------------------------------

## 1. Estructuras de Control (`if`, `else`)

Permiten ejecutar c贸digo solo si se cumple una condici贸n.

```{r}
#| label: if-else

siniestro <- 15000
limite <- 10000

if (siniestro > limite) {
  mensaje <- "Alerta: Siniestro excede el l铆mite"
  prioridad <- "Alta"
} else if (siniestro == limite) {
  mensaje <- "En el l铆mite exacto"
  prioridad <- "Media"
} else {
  mensaje <- "Siniestro dentro de par谩metros"
  prioridad <- "Baja"
}

print(paste(mensaje, "-", prioridad))
```

------------------------------------------------------------------------

### La versi贸n Vectorizada: ifelse()

En R, rara vez usamos if dentro de un bucle para una columna entera. Usamos ifelse().

```{r}
#| label: ifelse-vec

# Vector de siniestros
montos <- c(500, 12000, 800)

# ifelse(test, si_verdadero, si_falso)
status <- ifelse(montos > 10000, "Revisar", "Aprobar")

status
```

------------------------------------------------------------------------

## 2. Bucles (Loops)

Los bucles for y while son 煤tiles para simulaciones o tareas recursivas.

```{r}
#| label: for-loop

# Calcular crecimiento de una inversi贸n a帽o a a帽o
capital <- 1000
tasas <- c(0.05, 0.03) # Tasas variables

for (tasa in tasas) {
  interes <- capital * tasa
  capital <- capital + interes
  print(paste("Capital acumulado:", round(capital, 2)))
}
```

::: callout-warning
隆Ojo! En R, evita los bucles for si puedes hacer la operaci贸n directamente sobre el vector (vectorizaci贸n). Es mucho m谩s lento iterar fila por fila.
:::

------------------------------------------------------------------------

## 3. Funciones Personalizadas

La base de la programaci贸n robusta. Estructura:

```{r}
nombre <- function(argumentos) {
  # cuerpo del c贸digo
  return(resultado)
}
```

Ejemplo: Calcular Prima Pura de Riesgo.

```{r}
#| label: funcion-propia

calc_prima <- function(frecuencia, severidad, gastos = 0) {
  pura <- frecuencia * severidad
  comercial <- pura + gastos
  return(comercial)
}

# Probamos la funci贸n
calc_prima(frecuencia = 0.10, severidad = 5000, gastos = 50)
```

------------------------------------------------------------------------

## 4. La Familia apply (Base R)

Para aplicar una funci贸n a cada elemento de una lista o matriz sin usar bucles for.

::::: columns
::: {.column width="50%"}
lapply (List Apply) Devuelve siempre una lista.

```{r}
nums <- list(a=10, b=20)
lapply(nums, sqrt)
```
:::

::: {.column width="50%"}
sapply (Simplify Apply) Intenta devolver un vector o matriz.

```{r}
sapply(nums, sqrt)
```
:::
:::::

------------------------------------------------------------------------

### apply para Matrices

Ideal para operaciones por filas (1) o columnas (2).

```{r}
#| label: apply-matriz

matriz_riesgos <- matrix(1:9, nrow = 3)

# Sumar por FILAS (MARGIN = 1)
apply(matriz_riesgos, MARGIN = 1, sum)

# Promedio por COLUMNAS (MARGIN = 2)
apply(matriz_riesgos, MARGIN = 2, mean)
```

------------------------------------------------------------------------

## 5. Iteraci贸n con purrr (Tidyverse)

Es la evoluci贸n moderna de apply. M谩s consistente y predecible.

-   map(): Devuelve lista (igual a lapply).

-   map_dbl(): Devuelve vector num茅rico (double).

-   map_chr(): Devuelve vector de texto.

```{r}
#| label: purrr
library(purrr)

lista_precios <- list(100, 200, 500)

# Aplicar descuento del 10% a cada elemento
# La virgulilla (~) indica una funci贸n an贸nima
# El punto (.x) representa el elemento actual
map_dbl(lista_precios, ~ .x * 0.90)
```

------------------------------------------------------------------------

## Resumen de Flujo

-   L贸gica: if, else para decisiones puntuales. ifelse() para columnas de datos.

-   Repetici贸n: for (usar con moderaci贸n).

-   Abstracci贸n: Crea tus propias function().

-   Iteraci贸n Funcional:

-   Base: lapply, sapply.

-   Tidyverse: map, map_dbl.

<div style="position: fixed; bottom: 30px; right: 30px; z-index: 1000;">
  <a href="../index.qmd" class="btn btn-primary shadow-lg" role="button" style="border-radius: 50px; padding: 10px 20px;">
     Inicio
  </a>
</div>